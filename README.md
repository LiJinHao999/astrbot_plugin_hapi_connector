<div align="center">

![:name](https://count.getloli.com/@astrbot_plugin_hapi_connector?name=astrbot_plugin_hapi_connector&theme=minecraft&padding=6&offset=0&align=top&scale=1&pixelated=1&darkmode=auto)

# astrbot_plugin_hapi_connector

_âœ¨ éšæ—¶éšåœ° Vibe Coding âœ¨_

[![License](https://img.shields.io/badge/License-AGPLv3-blue.svg)](https://www.gnu.org/licenses/agpl-3.0.html)
[![Python 3.10+](https://img.shields.io/badge/Python-3.10%2B-blue.svg)](https://www.python.org/)
[![AstrBot](https://img.shields.io/badge/AstrBot-3.4%2B-orange.svg)](https://github.com/Soulter/AstrBot)
[![GitHub](https://img.shields.io/badge/ä½œè€…-LiJinHao999-blue)](https://github.com/LiJinHao999)

</div>

## ğŸ“¦ å®‰è£…æ–¹æ³•

åœ¨ AstrBot æ’ä»¶å¸‚åœºæœç´¢ **hapi_connector**ï¼Œç‚¹å‡»å®‰è£…å³å¯ã€‚

æˆ–æ‰‹åŠ¨å¡«å…¥ä»“åº“åœ°å€å®‰è£…ï¼š

```
https://github.com/LiJinHao999/astrbot_plugin_hapi_connector
```

ä¾èµ–ï¼ˆ`aiohttp`ã€`aiohttp-socks`ï¼‰ä¼šç”± AstrBot è‡ªåŠ¨å®‰è£…ã€‚

---

## ğŸ¤ è¿™æ˜¯å¹²å˜›ç”¨çš„ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ª**é€šè¿‡èŠå¤©æŒ‡ä»¤è¿œç¨‹ç®¡ç† AI ç¼–ç ä¼šè¯çš„æ’ä»¶**ã€‚

ä½ åœ¨å¤–é¢æ‘¸é±¼ï¼Œç”µè„‘åœ¨å®¶è·‘ä»£ç â€”â€”é€šè¿‡è¿™ä¸ªæ’ä»¶ï¼Œä½ å¯ä»¥åœ¨ QQã€å¾®ä¿¡ã€Telegram ç­‰ä»»æ„èŠå¤©å¹³å°ä¸Šï¼Œç›´æ¥æ“æ§è·‘åœ¨è¿œç«¯æœºå™¨ä¸Šçš„ Claude Code / Codex / Gemini / OpenCodeï¼Œå‘æ¶ˆæ¯ã€å®¡æ‰¹æƒé™ã€åˆ‡æ¢æ¨¡å‹ï¼Œä¸€æ¡æŒ‡ä»¤æå®šã€‚

**å®ƒè¿æ¥çš„åç«¯æ˜¯ [HAPI](https://github.com/tiann/hapi)**ï¼Œä¸€ä¸ªç»Ÿä¸€ç”¨äºæ–¹ä¾¿ç®¡ç†å¤šä¸ª AI ç¼–ç ä»£ç†ä¼šè¯åå°è¿è¡Œå’Œç®¡ç†çš„æœåŠ¡ï¼Œæ˜¯ [happy coder](https://github.com/slopus/happy?tab=readme-ov-file) çš„å¼€æºæœ¬åœ°å®ç°ç‰ˆæœ¬

> **ä¸€å¥è¯æ€»ç»“**ï¼š AI ç¼–ç ä¼šè¯çš„è¿œç¨‹æ§åˆ¶å°ã€‚

---

## ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯

- **ç¦»å¼€ç”µè„‘æ—¶ç»§ç»­æ¨è¿›ä»»åŠ¡**ï¼šæ‰‹æœºä¸Šå‘ä¸€æ¡æ¶ˆæ¯ï¼Œè®© Claude Code ç»§ç»­å¹²æ´»
- **å¿«é€Ÿå®¡æ‰¹æƒé™è¯·æ±‚**ï¼šAI è¦æ‰§è¡Œå±é™©æ“ä½œæ—¶ï¼Œæˆ³ä¸€æˆ³æœºå™¨äººæˆ–å‘ `/hapi a` ä¸€é”®æ”¾è¡Œ
- **å°†vibe codingçª—å£åˆ‡åˆ°åå°æ—¶æ¥æ”¶åŸç”ŸèŠå¤©è½¯ä»¶çš„é€šçŸ¥**ï¼šæ–¹ä¾¿vibeæ—¶æ‘¸é±¼ã€åšå…¶ä»–äº‹ï¼Œæå‡æ•ˆç‡
- **å¤šä¼šè¯å¹¶è¡Œç®¡ç†**ï¼šåŒæ—¶è·‘å¤šä¸ªé¡¹ç›®ï¼Œéšæ—¶åˆ‡æ¢ã€æŸ¥çœ‹è¿›åº¦
- **å®æ—¶æ¥æ”¶ AI è¾“å‡º**ï¼šåå° SSE æ¨é€ï¼ŒAI è¯´äº†ä»€ä¹ˆã€åšäº†ä»€ä¹ˆï¼Œç¬¬ä¸€æ—¶é—´æ¨åˆ°èŠå¤©çª—å£

---

## ğŸ§  æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ

1. æ’ä»¶å¯åŠ¨åè¿æ¥ HAPI æœåŠ¡ï¼Œå»ºç«‹ SSE é•¿è¿æ¥ç›‘å¬æ‰€æœ‰äº‹ä»¶
2. AI æœ‰æ–°æ¶ˆæ¯ã€æƒé™è¯·æ±‚ã€ä»»åŠ¡å®Œæˆæ—¶ï¼Œè‡ªåŠ¨æ¨é€åˆ°ä½ çš„èŠå¤©çª—å£
3. ä½ å‘æŒ‡ä»¤ â†’ æ’ä»¶è°ƒç”¨ HAPI REST API â†’ æ“ä½œå¯¹åº”çš„ AI ä¼šè¯
4. å¿«æ·å‰ç¼€ï¼ˆé»˜è®¤ `>`ï¼‰è®©ä½ ä¸ç”¨æ‰“ `/hapi to` é•¿ä¸²ä¹Ÿèƒ½å¿«é€Ÿå‘æ¶ˆæ¯

---

## âš™ï¸ é…ç½®

å®‰è£…ååœ¨ AstrBot ç®¡ç†é¢æ¿çš„æ’ä»¶é…ç½®é¡µå¡«å†™ï¼š

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `hapi_endpoint` | HAPI æœåŠ¡åœ°å€ï¼Œå¦‚ `http://localhost:3006` | |
| `access_token` | HAPI Access Tokenï¼Œæ”¯æŒ `token:namespace` æ ¼å¼ | |
| `proxy_url` | ä»£ç†åœ°å€ï¼Œæ”¯æŒ `socks5h://` å’Œ `http://` | ç©º |
| `jwt_lifetime` | JWT æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰ | 900 |
| `refresh_before_expiry` | JWT æå‰åˆ·æ–°æ—¶é—´ï¼ˆç§’ï¼‰ | 180 |
| `output_level` | SSE æ¨é€çº§åˆ«ï¼š`silence` / `simple` / `detail` | detail |
| `simple_msg_count` | simple çº§åˆ«æ˜¾ç¤ºçš„ agent æ¶ˆæ¯æ¡æ•° | 5 |
| `quick_prefix` | å¿«æ·å‘é€å‰ç¼€å­—ç¬¦ | `>` |
| `poke_approve` | æˆ³ä¸€æˆ³è‡ªåŠ¨å…¨éƒ¨å®¡æ‰¹ï¼ˆä»… QQ NapCatï¼‰ | å¼€å¯ |
| `remind_pending` | å¾…å®¡æ‰¹è¯·æ±‚è¶…æ—¶é‡å¤æé†’ï¼Œé˜²æ­¢ AI ä¼šè¯ç¼“å­˜å¤±æ•ˆ | å…³é—­ |
| `remind_interval` | å¾…å®¡æ‰¹æé†’é—´éš”ï¼ˆç§’ï¼‰ï¼Œå€’è®¡æ—¶å†…å¤„ç†å®Œåˆ™ä¸æé†’ | 180 |

---

## âŒ¨ï¸ æŒ‡ä»¤å¤§å…¨

æ‰€æœ‰æŒ‡ä»¤ä»¥ `/hapi` å¼€å¤´ï¼Œ**ä»…ç®¡ç†å‘˜å¯ç”¨**ã€‚

### ğŸ“‹ ä¼šè¯æŸ¥çœ‹

| æŒ‡ä»¤ | è¯´æ˜ |
|------|------|
| `/hapi list` | åˆ—å‡ºæ‰€æœ‰ä¼šè¯ï¼ˆåˆ«å `ls`ï¼‰ |
| `/hapi sw <åºå·æˆ–IDå‰ç¼€>` | åˆ‡æ¢å½“å‰ä¼šè¯ |
| `/hapi s` | æŸ¥çœ‹å½“å‰ä¼šè¯çŠ¶æ€ï¼ˆåˆ«å `status`ï¼‰ |
| `/hapi msg [è½®æ•°]` | æŸ¥çœ‹æœ€è¿‘æ¶ˆæ¯ï¼Œé»˜è®¤ 1 è½®ï¼ˆåˆ«å `messages`ï¼‰ |

### ğŸ’¬ æ¶ˆæ¯å‘é€

| æŒ‡ä»¤ | è¯´æ˜ |
|------|------|
| `/hapi to <åºå·> <å†…å®¹>` | å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šä¼šè¯ |
| `> æ¶ˆæ¯å†…å®¹` | å¿«æ·å‘é€åˆ°å½“å‰ä¼šè¯ |
| `>N æ¶ˆæ¯å†…å®¹` | å¿«æ·å‘é€åˆ°ç¬¬ N ä¸ªä¼šè¯ |

> å¿«æ·å‰ç¼€å¯åœ¨é…ç½®ä¸­ä¿®æ”¹ï¼Œé»˜è®¤ä¸º `>`

### ğŸ› ï¸ ä¼šè¯ç®¡ç†

| æŒ‡ä»¤ | è¯´æ˜ |
|------|------|
| `/hapi create` | åˆ›å»ºæ–°ä¼šè¯ï¼ˆ5 æ­¥äº¤äº’å‘å¯¼ï¼‰ |
| `/hapi abort [åºå·\|IDå‰ç¼€]` | ä¸­æ–­ä¼šè¯ï¼Œé»˜è®¤å½“å‰ï¼ˆåˆ«å `stop`ï¼‰ |
| `/hapi archive` | å½’æ¡£å½“å‰ä¼šè¯ |
| `/hapi rename` | é‡å‘½åå½“å‰ä¼šè¯ |
| `/hapi delete` | åˆ é™¤å½“å‰ä¼šè¯ |

### âœ… æƒé™å®¡æ‰¹

| æŒ‡ä»¤ | è¯´æ˜ |
|------|------|
| `/hapi pending` | æŸ¥çœ‹å¾…å®¡æ‰¹è¯·æ±‚åˆ—è¡¨ |
| `/hapi a` | æ‰¹å‡†æ‰€æœ‰æƒé™è¯·æ±‚ + äº¤äº’å¼å›ç­” questionï¼ˆåˆ«å `approve`ï¼‰ |
| `/hapi allow [åºå·]` | ä»…æ‰¹å‡†æ™®é€šæƒé™è¯·æ±‚ï¼ˆè·³è¿‡ questionï¼‰ |
| `/hapi answer [åºå·]` | äº¤äº’å¼å›ç­” question è¯·æ±‚ |
| `/hapi deny` | å…¨éƒ¨æ‹’ç» |
| `/hapi deny <åºå·>` | æ‹’ç»å•ä¸ªè¯·æ±‚ |
| æˆ³ä¸€æˆ³æœºå™¨äºº | æ‰¹å‡†æ‰€æœ‰æ™®é€šæƒé™è¯·æ±‚ + äº¤äº’å¼å›ç­” questionï¼ˆä»… QQ NapCatï¼Œéœ€å¼€å¯ `poke_approve`ï¼‰ |

### ğŸ”§ æ¨¡å¼åˆ‡æ¢

| æŒ‡ä»¤ | è¯´æ˜ |
|------|------|
| `/hapi perm [æ¨¡å¼]` | æŸ¥çœ‹/åˆ‡æ¢æƒé™æ¨¡å¼ï¼ˆä¸å¸¦å‚æ•°åˆ™äº¤äº’é€‰æ‹©ï¼‰ |
| `/hapi model [æ¨¡å¼]` | æŸ¥çœ‹/åˆ‡æ¢æ¨¡å‹ï¼ˆä»… Claudeï¼Œä¸å¸¦å‚æ•°åˆ™äº¤äº’é€‰æ‹©ï¼‰ |
| `/hapi output [çº§åˆ«]` | æŸ¥çœ‹/åˆ‡æ¢ SSE æ¨é€çº§åˆ«ï¼ˆåˆ«å `out`ï¼‰ |
| `/hapi help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

---

## ğŸ“¡ SSE æ¨é€çº§åˆ«è¯´æ˜

| çº§åˆ« | è¯´æ˜ |
|------|------|
| `silence` | ä»…æ¨é€æƒé™è¯·æ±‚å’Œç­‰å¾…è¾“å…¥æé†’ï¼Œå…¶ä½™é™é»˜ |
| `simple` | AI æ€è€ƒå®Œæˆåæ¨é€æœ€è¿‘ N æ¡ agent æ–‡æœ¬æ¶ˆæ¯ |
| `detail` | å®æ—¶æ¨é€æ‰€æœ‰æ–°æ¶ˆæ¯ï¼ˆä¿¡æ¯é‡è¾ƒå¤§ï¼Œé»˜è®¤ï¼‰ |

---

## ğŸ¤– æ”¯æŒçš„ AI ä»£ç†

| ä»£ç† | å¯ç”¨æƒé™æ¨¡å¼ |
|------|-------------|
| Claude Code | `default` / `acceptEdits` / `bypassPermissions` / `plan` |
| Codex | `default` / `read-only` / `safe-yolo` / `yolo` |
| Gemini | `default` / `read-only` / `safe-yolo` / `yolo` |
| OpenCode | `default` / `yolo` |

---

## ğŸ“ æ’ä»¶ç»“æ„

```
astrbot_plugin_hapi_connector/
â”œâ”€â”€ main.py              # æ’ä»¶å…¥å£ï¼šæŒ‡ä»¤ç»„ã€å‰ç¼€å¤„ç†ã€ç”Ÿå‘½å‘¨æœŸ
â”œâ”€â”€ hapi_client.py       # å¼‚æ­¥ HAPI HTTP å®¢æˆ·ç«¯ + JWT ç®¡ç†
â”œâ”€â”€ sse_listener.py      # åå° SSE ç›‘å¬ + æ¶ˆæ¯æ¨é€
â”œâ”€â”€ session_ops.py       # Session CRUD æ“ä½œ
â”œâ”€â”€ formatters.py        # æ ¼å¼åŒ–è¾“å‡º
â”œâ”€â”€ constants.py         # å¸¸é‡å®šä¹‰
â”œâ”€â”€ _conf_schema.json    # é…ç½® schema
â””â”€â”€ metadata.yaml        # æ’ä»¶å…ƒä¿¡æ¯
```

---

## ğŸ“Œ TODO

- [ ] é€šè¿‡ AstrBot è‡ªç„¶è¯­è¨€è§¦å‘æŒ‡ä»¤ï¼Œè®©èŠå¤© LLM æ„ŸçŸ¥å½“å‰ç¼–ç ä»»åŠ¡
- [ ] æ”¯æŒå¤šç”¨æˆ·ç‹¬ç«‹ä¼šè¯çŠ¶æ€

---

## ğŸ™ è‡´è°¢

- [HAPI](https://github.com/tiann/hapi) â€” æœ¬æ’ä»¶è¿æ¥çš„åç«¯æœåŠ¡ï¼Œç”± [@tiann](https://github.com/tiann) å¼€å‘
- [AstrBot](https://github.com/Soulter/AstrBot) â€” è·¨å¹³å°èŠå¤©æœºå™¨äººæ¡†æ¶

---

## ğŸ‘¥ è´¡çŒ®æŒ‡å—

- ğŸŒŸ Star æœ¬é¡¹ç›®
- ğŸ› æäº¤ Issue æŠ¥å‘Šé—®é¢˜
- ğŸ’¡ æå‡ºæ–°åŠŸèƒ½å»ºè®®
- ğŸ”§ æäº¤ Pull Request æ”¹è¿›ä»£ç 
